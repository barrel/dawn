{"version":3,"file":"cart-drawer.5e028317.js","sources":["../frontend/components/cart-drawer.js"],"sourcesContent":["import { trapFocus, removeTrapFocus } from '@/lib/a11y'\n\nclass CartDrawer extends HTMLElement {\n  constructor() {\n    super();\n\n    this.addEventListener('keyup', (evt) => evt.code === 'Escape' && this.close());\n    this.querySelector('#CartDrawer-Overlay').addEventListener('click', this.close.bind(this));\n    this.setHeaderCartIconAccessibility();\n  }\n\n  setHeaderCartIconAccessibility() {\n    const cartLink = document.querySelector('#cart-icon-bubble');\n    cartLink.setAttribute('role', 'button');\n    cartLink.setAttribute('aria-haspopup', 'dialog');\n    cartLink.addEventListener('click', (event) => {\n      event.preventDefault();\n      this.open(cartLink)\n    });\n    cartLink.addEventListener('keydown', (event) => {\n      if (event.code.toUpperCase() === 'SPACE') {\n        event.preventDefault();\n        this.open(cartLink);\n      }\n    });\n  }\n\n  open(triggeredBy) {\n    if (triggeredBy) this.setActiveElement(triggeredBy);\n    const cartDrawerNote = this.querySelector('[id^=\"Details-\"] summary');\n    if (cartDrawerNote && !cartDrawerNote.hasAttribute('role')) this.setSummaryAccessibility(cartDrawerNote);\n    // here the animation doesn't seem to always get triggered. A timeout seem to help\n    setTimeout(() => {this.classList.add('animate', 'active')});\n\n    this.addEventListener('transitionend', () => {\n      const containerToTrapFocusOn = this.classList.contains('is-empty') ? this.querySelector('.drawer__inner-empty') : document.getElementById('CartDrawer');\n      const focusElement = this.querySelector('.drawer__inner') || this.querySelector('.drawer__close');\n      trapFocus(containerToTrapFocusOn, focusElement);\n    }, { once: true });\n\n    document.body.classList.add('overflow-hidden');\n  }\n\n  close() {\n    this.classList.remove('active');\n    removeTrapFocus(this.activeElement);\n    document.body.classList.remove('overflow-hidden');\n  }\n\n  setSummaryAccessibility(cartDrawerNote) {\n    cartDrawerNote.setAttribute('role', 'button');\n    cartDrawerNote.setAttribute('aria-expanded', 'false');\n\n    if(cartDrawerNote.nextElementSibling.getAttribute('id')) {\n      cartDrawerNote.setAttribute('aria-controls', cartDrawerNote.nextElementSibling.id);\n    }\n\n    cartDrawerNote.addEventListener('click', (event) => {\n      event.currentTarget.setAttribute('aria-expanded', !event.currentTarget.closest('details').hasAttribute('open'));\n    });\n\n    cartDrawerNote.parentElement.addEventListener('keyup', onKeyUpEscape);\n  }\n\n  renderContents(parsedState) {\n    this.querySelector('.drawer__inner').classList.contains('is-empty') && this.querySelector('.drawer__inner').classList.remove('is-empty');\n    this.productId = parsedState.id;\n    this.getSectionsToRender().forEach((section => {\n      const sectionElement = section.selector ? document.querySelector(section.selector) : document.getElementById(section.id);\n      sectionElement.innerHTML =\n          this.getSectionInnerHTML(parsedState.sections[section.id], section.selector);\n    }));\n\n    setTimeout(() => {\n      this.querySelector('#CartDrawer-Overlay').addEventListener('click', this.close.bind(this));\n      this.open();\n    });\n  }\n\n  getSectionInnerHTML(html, selector = '.shopify-section') {\n    return new DOMParser()\n      .parseFromString(html, 'text/html')\n      .querySelector(selector).innerHTML;\n  }\n\n  getSectionsToRender() {\n    return [\n      {\n        id: 'cart-drawer',\n        selector: '#CartDrawer'\n      },\n      {\n        id: 'cart-icon-bubble'\n      }\n    ];\n  }\n\n  getSectionDOM(html, selector = '.shopify-section') {\n    return new DOMParser()\n      .parseFromString(html, 'text/html')\n      .querySelector(selector);\n  }\n\n  setActiveElement(element) {\n    this.activeElement = element;\n  }\n}\n\ncustomElements.define('cart-drawer', CartDrawer);\n"],"names":[],"mappings":"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"}