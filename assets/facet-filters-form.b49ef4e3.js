import{d as u}from"./utils.d62a6586.js";import{o as m}from"./a11y.88ed79d0.js";class n extends HTMLElement{constructor(){super(),this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.debouncedOnSubmit=u(r=>{this.onSubmitHandler(r)},500),this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this));const t=this.querySelector("#FacetsWrapperDesktop");t&&t.addEventListener("keyup",m)}static setListeners(){const e=t=>{const r=t.state?t.state.searchParams:n.searchParamsInitial;r!==n.searchParamsPrev&&n.renderPage(r,null,!1)};window.addEventListener("popstate",e)}static toggleActiveFacets(e=!0){document.querySelectorAll(".js-facet-remove").forEach(t=>{t.classList.toggle("disabled",e)})}static renderPage(e,t,r=!0){n.searchParamsPrev=e;const o=n.getSections(),c=document.getElementById("ProductCount"),i=document.getElementById("ProductCountDesktop");document.getElementById("ProductGridContainer").querySelector(".collection").classList.add("loading"),c&&c.classList.add("loading"),i&&i.classList.add("loading"),o.forEach(d=>{const s=`${window.location.pathname}?section_id=${d.section}&${e}`,a=l=>l.url===s;n.filterData.some(a)?n.renderSectionFromCache(a,t):n.renderSectionFromFetch(s,t)}),r&&n.updateURLHash(e)}static renderSectionFromFetch(e,t){fetch(e).then(r=>r.text()).then(r=>{const o=r;n.filterData=[...n.filterData,{html:o,url:e}],n.renderFilters(o,t),n.renderProductGridContainer(o),n.renderProductCount(o)})}static renderSectionFromCache(e,t){const r=n.filterData.find(e).html;n.renderFilters(r,t),n.renderProductGridContainer(r),n.renderProductCount(r)}static renderProductGridContainer(e){document.getElementById("ProductGridContainer").innerHTML=new DOMParser().parseFromString(e,"text/html").getElementById("ProductGridContainer").innerHTML}static renderProductCount(e){const t=new DOMParser().parseFromString(e,"text/html").getElementById("ProductCount").innerHTML,r=document.getElementById("ProductCount"),o=document.getElementById("ProductCountDesktop");r.innerHTML=t,r.classList.remove("loading"),o&&(o.innerHTML=t,o.classList.remove("loading"))}static renderFilters(e,t){const r=new DOMParser().parseFromString(e,"text/html"),o=r.querySelectorAll("#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter, #FacetFiltersPillsForm .js-filter"),c=s=>{const a=t?t.target.closest(".js-filter"):void 0;return a?s.dataset.index===a.dataset.index:!1},i=Array.from(o).filter(s=>!c(s)),d=Array.from(o).find(c);i.forEach(s=>{document.querySelector(`.js-filter[data-index="${s.dataset.index}"]`).innerHTML=s.innerHTML}),n.renderActiveFacets(r),n.renderAdditionalElements(r),d&&n.renderCounts(d,t.target.closest(".js-filter"))}static renderActiveFacets(e){[".active-facets-mobile",".active-facets-desktop"].forEach(r=>{const o=e.querySelector(r);!o||(document.querySelector(r).innerHTML=o.innerHTML)}),n.toggleActiveFacets(!1)}static renderAdditionalElements(e){[".mobile-facets__open",".mobile-facets__count",".sorting"].forEach(r=>{!e.querySelector(r)||(document.querySelector(r).innerHTML=e.querySelector(r).innerHTML)}),document.getElementById("FacetFiltersFormMobile").closest("menu-drawer").bindEvents()}static renderCounts(e,t){const r=t.querySelector(".facets__selected"),o=e.querySelector(".facets__selected"),c=t.querySelector(".facets__summary"),i=e.querySelector(".facets__summary");o&&r&&(t.querySelector(".facets__selected").outerHTML=e.querySelector(".facets__selected").outerHTML),c&&i&&(t.querySelector(".facets__summary").outerHTML=e.querySelector(".facets__summary").outerHTML)}static updateURLHash(e){history.pushState({searchParams:e},"",`${window.location.pathname}${e&&"?".concat(e)}`)}static getSections(){return[{section:document.getElementById("product-grid").dataset.id}]}createSearchParams(e){const t=new FormData(e);return new URLSearchParams(t).toString()}onSubmitForm(e,t){n.renderPage(e,t)}onSubmitHandler(e){e.preventDefault();const t=document.querySelectorAll("facet-filters-form form");if(e.srcElement.className=="mobile-facets__checkbox"){const r=this.createSearchParams(e.target.closest("form"));this.onSubmitForm(r,e)}else{const r=[],o=e.target.closest("form").id==="FacetFiltersFormMobile";t.forEach(c=>{o?c.id==="FacetFiltersFormMobile"&&r.push(this.createSearchParams(c)):(c.id==="FacetSortForm"||c.id==="FacetFiltersForm"||c.id==="FacetSortDrawerForm")&&r.push(this.createSearchParams(c))}),this.onSubmitForm(r.join("&"),e)}}onActiveFilterClick(e){e.preventDefault(),n.toggleActiveFacets();const t=e.currentTarget.href.indexOf("?")==-1?"":e.currentTarget.href.slice(e.currentTarget.href.indexOf("?")+1);n.renderPage(t)}}n.filterData=[];n.searchParamsInitial=window.location.search.slice(1);n.searchParamsPrev=window.location.search.slice(1);customElements.define("facet-filters-form",n);n.setListeners();
//# sourceMappingURL=facet-filters-form.b49ef4e3.js.map
