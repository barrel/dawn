{"version":3,"file":"pickup-availability.4efeb9ca.js","sources":["../frontend/components/pickup-availability.js"],"sourcesContent":["if (!customElements.get('pickup-availability')) {\n  customElements.define('pickup-availability', class PickupAvailability extends HTMLElement {\n    constructor() {\n      super();\n\n      if(!this.hasAttribute('available')) return;\n\n      this.errorHtml = this.querySelector('template').content.firstElementChild.cloneNode(true);\n      this.onClickRefreshList = this.onClickRefreshList.bind(this);\n      this.fetchAvailability(this.dataset.variantId);\n    }\n\n    fetchAvailability(variantId) {\n      let rootUrl = this.dataset.rootUrl;\n      if (!rootUrl.endsWith(\"/\")) {\n        rootUrl = rootUrl + \"/\";\n      }\n      const variantSectionUrl = `${rootUrl}variants/${variantId}/?section_id=pickup-availability`;\n\n      fetch(variantSectionUrl)\n        .then(response => response.text())\n        .then(text => {\n          const sectionInnerHTML = new DOMParser()\n            .parseFromString(text, 'text/html')\n            .querySelector('.shopify-section');\n          this.renderPreview(sectionInnerHTML);\n        })\n        .catch(e => {\n          const button = this.querySelector('button');\n          if (button) button.removeEventListener('click', this.onClickRefreshList);\n          this.renderError();\n        });\n    }\n\n    onClickRefreshList(evt) {\n      this.fetchAvailability(this.dataset.variantId);\n    }\n\n    renderError() {\n      this.innerHTML = '';\n      this.appendChild(this.errorHtml);\n\n      this.querySelector('button').addEventListener('click', this.onClickRefreshList);\n    }\n\n    renderPreview(sectionInnerHTML) {\n      const drawer = document.querySelector('pickup-availability-drawer');\n      if (drawer) drawer.remove();\n      if (!sectionInnerHTML.querySelector('pickup-availability-preview')) {\n        this.innerHTML = \"\";\n        this.removeAttribute('available');\n        return;\n      }\n\n      this.innerHTML = sectionInnerHTML.querySelector('pickup-availability-preview').outerHTML;\n      this.setAttribute('available', '');\n\n      document.body.appendChild(sectionInnerHTML.querySelector('pickup-availability-drawer'));\n\n      const button = this.querySelector('button');\n      if (button) button.addEventListener('click', (evt) => {\n        document.querySelector('pickup-availability-drawer').show(evt.target);\n      });\n    }\n  });\n}\n\nif (!customElements.get('pickup-availability-drawer')) {\n  customElements.define('pickup-availability-drawer', class PickupAvailabilityDrawer extends HTMLElement {\n    constructor() {\n      super();\n\n      this.onBodyClick = this.handleBodyClick.bind(this);\n\n      this.querySelector('button').addEventListener('click', () => {\n        this.hide();\n      });\n\n      this.addEventListener('keyup', () => {\n        if(event.code.toUpperCase() === 'ESCAPE') this.hide();\n      });\n    }\n\n    handleBodyClick(evt) {\n      const target = evt.target;\n      if (target != this && !target.closest('pickup-availability-drawer') && target.id != 'ShowPickupAvailabilityDrawer') {\n        this.hide();\n      }\n    }\n\n    hide() {\n      this.removeAttribute('open');\n      document.body.removeEventListener('click', this.onBodyClick);\n      document.body.classList.remove('overflow-hidden');\n      removeTrapFocus(this.focusElement);\n    }\n\n    show(focusElement) {\n      this.focusElement = focusElement;\n      this.setAttribute('open', '');\n      document.body.addEventListener('click', this.onBodyClick);\n      document.body.classList.add('overflow-hidden');\n      trapFocus(this);\n    }\n  });\n}\n"],"names":[],"mappings":"AAAA,AAAK,eAAe,IAAI,qBAAqB,GAC3C,eAAe,OAAO,sBAAuB,aAAiC,YAAY,CACxF,aAAc,CAGZ,AAFA,QAEG,AAAC,KAAK,aAAa,WAAW,GAEjC,MAAK,UAAY,KAAK,cAAc,UAAU,EAAE,QAAQ,kBAAkB,UAAU,EAAI,EACxF,KAAK,mBAAqB,KAAK,mBAAmB,KAAK,IAAI,EAC3D,KAAK,kBAAkB,KAAK,QAAQ,SAAS,EAC9C,CAED,kBAAkB,EAAW,CAC3B,GAAI,GAAU,KAAK,QAAQ,QAC3B,AAAK,EAAQ,SAAS,GAAG,GACvB,GAAU,EAAU,KAEtB,KAAM,GAAoB,GAAG,aAAmB,oCAEhD,MAAM,CAAiB,EACpB,KAAK,GAAY,EAAS,MAAM,EAChC,KAAK,GAAQ,CACZ,KAAM,GAAmB,GAAI,WAAW,EACrC,gBAAgB,EAAM,WAAW,EACjC,cAAc,kBAAkB,EACnC,KAAK,cAAc,CAAgB,CAC7C,CAAS,EACA,MAAM,GAAK,CACV,KAAM,GAAS,KAAK,cAAc,QAAQ,EAC1C,AAAI,GAAQ,EAAO,oBAAoB,QAAS,KAAK,kBAAkB,EACvE,KAAK,YAAW,CAC1B,CAAS,CACJ,CAED,mBAAmB,EAAK,CACtB,KAAK,kBAAkB,KAAK,QAAQ,SAAS,CAC9C,CAED,aAAc,CACZ,KAAK,UAAY,GACjB,KAAK,YAAY,KAAK,SAAS,EAE/B,KAAK,cAAc,QAAQ,EAAE,iBAAiB,QAAS,KAAK,kBAAkB,CAC/E,CAED,cAAc,EAAkB,CAC9B,KAAM,GAAS,SAAS,cAAc,4BAA4B,EAElE,GADI,GAAQ,EAAO,SACf,CAAC,EAAiB,cAAc,6BAA6B,EAAG,CAClE,KAAK,UAAY,GACjB,KAAK,gBAAgB,WAAW,EAChC,MACD,CAED,KAAK,UAAY,EAAiB,cAAc,6BAA6B,EAAE,UAC/E,KAAK,aAAa,YAAa,EAAE,EAEjC,SAAS,KAAK,YAAY,EAAiB,cAAc,4BAA4B,CAAC,EAEtF,KAAM,GAAS,KAAK,cAAc,QAAQ,EAC1C,AAAI,GAAQ,EAAO,iBAAiB,QAAS,AAAC,GAAQ,CACpD,SAAS,cAAc,4BAA4B,EAAE,KAAK,EAAI,MAAM,CAC5E,CAAO,CACF,CACL,CAAG,EAGH,AAAK,eAAe,IAAI,4BAA4B,GAClD,eAAe,OAAO,6BAA8B,aAAuC,YAAY,CACrG,aAAc,CACZ,QAEA,KAAK,YAAc,KAAK,gBAAgB,KAAK,IAAI,EAEjD,KAAK,cAAc,QAAQ,EAAE,iBAAiB,QAAS,IAAM,CAC3D,KAAK,KAAI,CACjB,CAAO,EAED,KAAK,iBAAiB,QAAS,IAAM,CACnC,AAAG,MAAM,KAAK,YAAW,IAAO,UAAU,KAAK,MACvD,CAAO,CACF,CAED,gBAAgB,EAAK,CACnB,KAAM,GAAS,EAAI,OACnB,AAAI,GAAU,MAAQ,CAAC,EAAO,QAAQ,4BAA4B,GAAK,EAAO,IAAM,gCAClF,KAAK,KAAI,CAEZ,CAED,MAAO,CACL,KAAK,gBAAgB,MAAM,EAC3B,SAAS,KAAK,oBAAoB,QAAS,KAAK,WAAW,EAC3D,SAAS,KAAK,UAAU,OAAO,iBAAiB,EAChD,gBAAgB,KAAK,YAAY,CAClC,CAED,KAAK,EAAc,CACjB,KAAK,aAAe,EACpB,KAAK,aAAa,OAAQ,EAAE,EAC5B,SAAS,KAAK,iBAAiB,QAAS,KAAK,WAAW,EACxD,SAAS,KAAK,UAAU,IAAI,iBAAiB,EAC7C,UAAU,IAAI,CACf,CACL,CAAG"}